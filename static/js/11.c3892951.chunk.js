(this.webpackJsonplinkbook=this.webpackJsonplinkbook||[]).push([[11],{212:function(t,e,a){"use strict";a.d(e,"a",(function(){return _}));var n=a(12),o=a(19),s=a(114),c=a(196),i=a(68),r=a(185),l=a(221),d=a(184),j=a(209),u=a(229),m=a(188),h=a(193),p=a(207),b=a(180),g=a(197),O=a(205),x=a(195),f=a(228),v=a(18),k=a(217),S=a.n(k),y=a(218),w=a.n(y),E=a(219),I=a.n(E),P=a(220),R=a.n(P),C=a(0),L=a.n(C),T=a(181),D=a(81),M=a(82),N=a(84),B=a(83),F=a(87),V=a(33),A=a(2),G=function(t){Object(N.a)(a,t);var e=Object(B.a)(a);function a(){var t;Object(D.a)(this,a);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).state={user:null,isLoading:!0},t}return Object(M.a)(a,[{key:"componentDidMount",value:function(){var t=this;fetch("".concat(V.SERVER,"/users/avatar?userId=").concat(this.props.comment.userId),{method:"GET",credentials:"include"}).then((function(t){return t.json()})).then((function(e){e.success?t.setState({user:e,isLoading:!1}):t.setState({user:{login:null,avatar:null,userId:t.props.comment.userID},isLoading:!1})})).catch((function(e){t.setState({user:{login:null,avatar:null,userId:t.props.comment.userID},isLoading:!1})}))}},{key:"render",value:function(){return Object(A.jsx)(L.a.Fragment,{children:Object(A.jsxs)(m.a,{style:{display:"flex"},children:[this.state.isLoading?Object(A.jsx)(f.a,{animation:"wave",variant:"circle",width:40,height:40}):Object(A.jsx)(d.a,{component:v.b,to:"/users/".concat(this.state.user.login),"aria-label":"user profile",style:{padding:0,height:"max-content"},children:Object(A.jsx)(j.a,{"aria-label":"user avatar",src:this.state.user.avatar?"".concat(V.SERVER).concat(this.state.user.avatar):""})}),Object(A.jsxs)("div",{style:{marginLeft:16,flexGrow:1},children:[this.state.isLoading?Object(A.jsx)(f.a,{animation:"wave",height:10,width:"40%",style:{marginBottom:18}}):Object(A.jsxs)(i.a,{component:"p",children:[Object(A.jsx)(i.a,{variant:"subtitle2",component:v.b,to:"/users/".concat(this.state.user.login),color:"inherit",style:{textDecoration:"none"},children:this.state.user.login}),Object(A.jsx)(i.a,{component:"span",variant:"caption",style:{marginLeft:8},children:Object(F.a)(this.props.comment.created_at)})]}),this.state.isLoading?Object(A.jsx)(f.a,{animation:"wave",height:10,width:"80%",style:{marginBottom:12}}):Object(A.jsx)(i.a,{component:"p",variant:"body2",style:{marginTop:8},children:this.props.comment.value})]})]})})}}]),a}(C.Component),z=a(34),J=a(39),U=a(86),W=Object(T.a)((function(t){return{card:{borderRadius:10,margin:"auto",marginBottom:t.spacing(3)},cardContent:{paddingTop:0,paddingBottom:0},marginLeft:{marginLeft:t.spacing(2)},commentForm:{display:"flex",alignItems:"center"},commentAvatar:{marginRight:t.spacing(2)},progressbar:{position:"absolute",top:"50%",left:"50%",marginTop:-4,marginLeft:-12},noPadding:{padding:0},media:{paddingTop:"56.25%"}}}));function _(t){var e=W(),a=L.a.useState(!1),k=Object(o.a)(a,2),y=k[0],E=k[1],P=L.a.useState(!0),C=Object(o.a)(P,2),T=C[0],D=C[1],M=L.a.useContext(z.a).authDispatch,N=L.a.useState(t.post),B=Object(o.a)(N,2),F=B[0],_=B[1],q=L.a.useState({comment:""}),H=Object(o.a)(q,2),K=H[0],Q=H[1],X=L.a.useState(),Y=Object(o.a)(X,2),Z=Y[0],$=Y[1],tt=L.a.useState(null),et=Object(o.a)(tt,2),at=et[0],nt=et[1],ot=L.a.useContext(U.a),st=L.a.useState({comment:!1,delete:!1}),ct=Object(o.a)(st,2),it=ct[0],rt=ct[1],lt=L.a.useState(!1),dt=Object(o.a)(lt,2),jt=dt[0],ut=dt[1],mt=Object(J.b)().enqueueSnackbar,ht=new Date(F.created_at).toDateString().split(" "),pt=function(){nt(null)},bt=Boolean(at),gt="post-".concat(F.postId,"-menu"),Ot=Object(A.jsxs)(s.a,{anchorEl:at,anchorOrigin:{vertical:"top",horizontal:"left"},id:gt,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:bt,onClose:pt,children:[Object(A.jsx)(c.a,{onClick:pt,disabled:!0,children:"Save Post"}),Object(A.jsx)(c.a,{onClick:pt,disabled:!0,children:"Report post"}),!T&&t.notSkeleton&&F.owner&&ot.userId===F.owner.userId&&Object(A.jsx)("div",{children:Object(A.jsx)(c.a,{onClick:function(){pt(),function(){var t={postId:F.postId};window.confirm("Are you sure you want to delete post?")&&fetch("".concat(V.SERVER,"/posts/delete"),{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)}).then((function(t){return t.json()})).then((function(t){t.success?(mt("Post Deleted!",{variant:"success"}),M({type:"REFUSER"}),E(!0)):(mt(t.message,{variant:"error"}),rt({delete:!1}))})).catch((function(t){mt("Post deletion failed!",{variant:"error"}),rt({delete:!1}),console.error("Error:",t)}))}()},children:Object(A.jsx)(i.a,{color:"secondary",children:"Delete post"})})})]}),xt=function(){fetch("".concat(V.SERVER,"/posts/like?postId=").concat(F.postId),{method:"POST",credentials:"include"}).then((function(t){return t.json()})).then((function(t){t.success&&(t.success?(t.liked?_(Object(n.a)(Object(n.a)({},F),{},{likes:F.likes+1})):_(Object(n.a)(Object(n.a)({},F),{},{likes:F.likes-1})),$(t.liked)):(401===t.status&&M({type:"logout"}),mt(t.message,{variant:"error"})))})).catch((function(t){mt("Failed to like post",{variant:"error"})}))};return L.a.useEffect((function(){t.notSkeleton&&F.postId&&fetch("".concat(V.SERVER,"/posts/like?postId=").concat(F.postId),{method:"GET",credentials:"include"}).then((function(t){return t.json()})).then((function(t){t.success&&$(t.liked),D(!1)})).catch((function(t){D(!1)}))}),[$,F.postId,t.notSkeleton]),Object(A.jsxs)(L.a.Fragment,{children:[!y&&Object(A.jsxs)(r.a,{className:e.card,variant:"outlined",children:[Object(A.jsx)(l.a,{avatar:!T&&t.notSkeleton?Object(A.jsx)(d.a,{component:v.b,to:"/users/".concat(F.owner.login),className:e.noPadding,"aria-label":"user profile",children:Object(A.jsx)(j.a,{"aria-label":"user avatar",alt:F.owner.login,src:F.owner.avatar?"".concat(V.SERVER).concat(F.owner.avatar):""})}):Object(A.jsx)(f.a,{animation:"wave",variant:"circle",width:40,height:40}),action:!T&&t.notSkeleton?Object(A.jsx)(d.a,{"aria-label":"Post options","aria-controls":gt,"aria-haspopup":"true",onClick:function(t){nt(t.currentTarget)},children:Object(A.jsx)(S.a,{})}):null,title:T?Object(A.jsx)(f.a,{animation:"wave",height:10,width:"80%",style:{marginBottom:6}}):Object(A.jsx)(i.a,{component:v.b,to:"/users/".concat(F.owner.login),color:"inherit",variant:"body2",style:{textDecoration:"none"},children:F.owner.login}),subheader:T?Object(A.jsx)(f.a,{animation:"wave",height:10,width:"40%"}):"".concat(ht[1]," ").concat(ht[2]," ").concat(ht[3])}),!T&&t.notSkeleton?F.postImage&&Object(A.jsx)(u.a,{style:{height:0,paddingTop:"56.25%"},image:"".concat(V.SERVER).concat(F.postImage),title:"".concat(F.owner.login,"'s post"),alt:F.postImage,to:"/posts/".concat(F.postId),component:t.single?m.a:v.b}):Object(A.jsx)(f.a,{animation:"wave",variant:"rect",className:e.media}),Object(A.jsx)(m.a,{children:!T&&t.notSkeleton?Object(A.jsx)(i.a,{component:"p",children:F.postText}):Object(A.jsxs)(L.a.Fragment,{children:[Object(A.jsx)(f.a,{animation:"wave",height:10,style:{marginBottom:6}}),Object(A.jsx)(f.a,{animation:"wave",height:10,width:"80%"})]})}),!T&&t.notSkeleton?Object(A.jsxs)(i.a,{className:e.marginLeft,variant:"subtitle2",component:"p",children:[F.likes," ",F.like>1?"Likes":"Like",Object(A.jsxs)(i.a,{component:"span",variant:"subtitle2",className:e.marginLeft,children:[F.comments," ",F.comments>1?"Comments":"Comment"]})]}):Object(A.jsx)(f.a,{animation:"wave",height:10,width:"50%",style:{marginLeft:16,marginBottom:11}}),Object(A.jsx)(h.a,{disableSpacing:!0,children:t.notSkeleton?Object(A.jsxs)(L.a.Fragment,{children:[Z?Object(A.jsx)(p.a,{title:"Unlike this",children:Object(A.jsx)(d.a,{"aria-label":"unlike",onClick:xt,color:"primary",children:Object(A.jsx)(w.a,{color:"inherit"})})}):Object(A.jsx)(p.a,{title:"Like this",children:Object(A.jsx)(d.a,{"aria-label":"like",onClick:xt,children:Object(A.jsx)(w.a,{})})}),Object(A.jsx)(p.a,{title:"Comments",children:Object(A.jsx)(d.a,{className:e.marginLeft,"aria-label":"comment",onClick:function(){ut(!jt)},children:Object(A.jsx)(I.a,{})})})]}):Object(A.jsx)("div",{style:{height:36}})}),Object(A.jsxs)(b.a,{in:jt,timeout:"auto",unmountOnExit:!0,children:[Object(A.jsx)(g.a,{}),Object(A.jsx)(m.a,{children:Object(A.jsxs)("form",{onSubmit:function(t){if(t.preventDefault(),K.comment){rt({comment:!0});var e={postId:F.postId,value:K.comment};fetch("".concat(V.SERVER,"/posts/comment"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}).then((function(t){return t.json()})).then((function(t){if(t.success){Q({comment:""}),mt(t.message,{variant:"success"});var e=F.commentslist;e.unshift(t),_(Object(n.a)(Object(n.a)({},F),{},{comments:F.comments+1,commentslist:e}))}else 401===t.status&&M({type:"logout"}),mt(t.message,{variant:"error"});rt({comment:!1})})).catch((function(t){mt("Failed to get post",{variant:"error"}),rt({comment:!1}),console.error("Error:",t)}))}else mt("Comment can't be empty",{variant:"warning"})},className:e.commentForm,children:[ot&&Object(A.jsx)(j.a,{src:ot.avatar?"".concat(V.SERVER).concat(ot.avatar):"",className:e.commentAvatar}),Object(A.jsx)(O.a,{id:"commentInput",label:"Write a comment...",onChange:function(t){Q(Object(n.a)(Object(n.a)({},K),{},{comment:t.target.value}))},value:K.comment,fullWidth:!0}),Object(A.jsxs)("div",{style:{position:"relative"},children:[Object(A.jsx)(p.a,{title:"Add Comment",children:Object(A.jsx)(d.a,{"aria-label":"add comment",color:"primary",type:"submit",disabled:it.comment,children:Object(A.jsx)(R.a,{})})}),it.comment&&Object(A.jsx)(x.a,{size:24,className:e.progressbar})]})]})}),t.notSkeleton&&F.commentslist.map((function(t){return Object(A.jsx)(G,{comment:t},t.commentId)}))]})]}),Ot]})}},216:function(t,e,a){"use strict";var n=a(12),o=a(81),s=a(82),c=a(84),i=a(83),r=a(0),l=a.n(r),d=a(212),j=a(33),u=a(15),m=a(215),h=a(194),p=a(195),b=a(2),g=function(t){Object(c.a)(a,t);var e=Object(i.a)(a);function a(){var t;Object(o.a)(this,a);for(var s=arguments.length,c=new Array(s),i=0;i<s;i++)c[i]=arguments[i];return(t=e.call.apply(e,[this].concat(c))).state={data:null,loadMore:!1,nextPage:1},t.nullPost={postId:null,userId:null,postImage:null,postText:null,created_at:null},t.getPosts=function(e){fetch("".concat(j.SERVER).concat(t.props.url,"?page=").concat(e),{method:"GET",credentials:"include"}).then((function(t){return t.json()})).then((function(e){e.success?t.state.nextPage>1?t.setState(Object(n.a)(Object(n.a)({},t.state),{},{data:{next:e.next,posts:t.state.data.posts.concat(e.posts)},nextPage:t.state.nextPage+1,loadMore:!1})):t.setState(Object(n.a)(Object(n.a)({},t.state),{},{data:e,nextPage:t.state.nextPage+1,loadMore:!1})):(401===e.status&&(t.props.page?t.props.history.push(t.props.page):t.props.history.push("/login")),t.setState(Object(n.a)(Object(n.a)({},t.state),{},{nextPage:t.state.nextPage-1,loadMore:!1})),t.props.history.push("/login"))})).catch((function(e){t.setState(Object(n.a)(Object(n.a)({},t.state),{},{nextPage:t.state.nextPage-1,loadMore:!1})),console.error("Error:",e)}))},t.handleLoadMore=function(){t.setState(Object(n.a)(Object(n.a)({},t.state),{},{loadMore:!0})),t.getPosts(t.state.nextPage)},t}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.getPosts(this.state.nextPage)}},{key:"componentDidUpdate",value:function(t){this.props.authState.refreshPost!==t.authState.refreshPost&&(this.setState(Object(n.a)(Object(n.a)({},this.state),{},{nextPage:1})),this.getPosts(1))}},{key:"render",value:function(){return Object(b.jsxs)(l.a.Fragment,{children:[this.state.data?this.state.data.posts.map((function(t){return Object(b.jsx)(d.a,{post:t,notSkeleton:!0},t.postId)})):Object(b.jsxs)(l.a.Fragment,{children:[Object(b.jsx)(d.a,{notSkeleton:!1,post:this.nullPost},"skelton1"),Object(b.jsx)(d.a,{notSkeleton:!1,post:this.nullPost},"skelton2")]}),this.state.data&&this.state.data.next&&Object(b.jsxs)(m.a,{display:"flex",justifyContent:"center",style:{position:"relative",marginBottom:24},children:[Object(b.jsx)(h.a,{variant:"outlined",color:"primary",onClick:this.handleLoadMore,disabled:this.state.loadMore,children:"Load More"}),this.state.loadMore&&Object(b.jsx)(p.a,{size:24,style:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}})]})]})}}]),a}(r.Component);e.a=Object(u.j)(g)},238:function(t,e,a){"use strict";a.r(e);var n=a(45),o=a(0),s=a.n(o),c=a(215),i=a(187),r=a(68),l=a(181),d=a(34),j=a(216),u=a(2),m=Object(l.a)((function(t){return{root:Object(n.a)({display:"flex"},t.breakpoints.up("sm"),{margin:t.spacing(2)}),marginBottom:{marginBottom:t.spacing(3)}}}));e.default=function(){var t=s.a.useContext(d.a).authState,e=m();return Object(u.jsx)(s.a.Fragment,{children:Object(u.jsx)(c.a,{className:e.root,children:Object(u.jsxs)(i.a,{maxWidth:"sm",disableGutters:!0,children:[Object(u.jsx)(r.a,{variant:"h4",className:e.marginBottom,children:"Trending"}),Object(u.jsx)(j.a,{authState:t,url:"/posts/trending/"})]})})})}}}]);
//# sourceMappingURL=11.c3892951.chunk.js.map